import{r as g,R as K}from"./index.BufDd4G-.js";let N=0;function Se(e,u){const f=`atom${++N}`,E={toString:()=>f};return typeof e=="function"?E.read=e:(E.init=e,E.read=Y,E.write=Z),u&&(E.write=u),E}function Y(e){return e(this)}function Z(e,u,f){return u(this,typeof f=="function"?f(e(this)):f)}const L=(e,u)=>e.unstable_is?e.unstable_is(u):u===e,k=e=>"init"in e,j=e=>!!e.write,O=new WeakMap,Q=(e,u)=>{O.set(e,u),e.catch(()=>{}).finally(()=>O.delete(e))},C=(e,u)=>{const f=O.get(e);f&&(O.delete(e),f(u))},W=(e,u)=>{e.status="fulfilled",e.value=u},z=(e,u)=>{e.status="rejected",e.reason=u},ee=e=>typeof e?.then=="function",m=(e,u)=>!!e&&"v"in e&&"v"in u&&Object.is(e.v,u.v),q=(e,u)=>!!e&&"e"in e&&"e"in u&&Object.is(e.e,u.e),D=e=>!!e&&"v"in e&&e.v instanceof Promise,te=(e,u)=>"v"in e&&"v"in u&&e.v.orig&&e.v.orig===u.v.orig,T=e=>{if("e"in e)throw e.e;return e.v},ne=()=>{const e=new WeakMap,u=new WeakMap,f=[],E=new WeakMap;let P,U;const p=t=>e.get(t),R=(t,i)=>{i.d.forEach((d,r)=>{var s;if(!E.has(r)){const o=p(r);(s=f[f.length-1])==null||s.add(r),E.set(r,[o,new Set]),o&&R(r,o)}E.get(r)[1].add(t)})},A=(t,i)=>{var d;const r=p(t);if(e.set(t,i),E.has(t)||((d=f[f.length-1])==null||d.add(t),E.set(t,[r,new Set]),R(t,i)),D(r)){const s="v"in i?i.v instanceof Promise?i.v:Promise.resolve(i.v):Promise.reject(i.e);r.v!==s&&C(r.v,s)}},v=(t,i,d,r)=>{const s=new Map(r?i.d:null);let o=!1;d.forEach((n,c)=>{!n&&L(t,c)&&(n=i),n&&(s.set(c,n),i.d.get(c)!==n&&(o=!0))}),(o||i.d.size!==s.size)&&(i.d=s)},_=(t,i,d,r)=>{const s=p(t),o={d:s?.d||new Map,v:i};if(d&&v(t,o,d,r),m(s,o)&&s.d===o.d)return s;if(D(s)&&D(o)&&te(s,o)){if(s.d===o.d)return s;o.v=s.v}return A(t,o),o},F=(t,i,d,r)=>{if(ee(i)){let s;const o=()=>{const c=p(t);if(!D(c)||c.v!==n)return;const S=_(t,n,d);u.has(t)&&c.d!==S.d&&X(t,S,c.d)},n=new Promise((c,S)=>{let l=!1;i.then(a=>{l||(l=!0,W(n,a),c(a),o())},a=>{l||(l=!0,z(n,a),S(a),o())}),s=a=>{l||(l=!0,a.then(h=>W(n,h),h=>z(n,h)),c(a))}});return n.orig=i,n.status="pending",Q(n,c=>{c&&s(c),r?.()}),_(t,n,d,!0)}return _(t,i,d)},$=(t,i,d)=>{const r=p(t),s={d:r?.d||new Map,e:i};return d&&v(t,s,d),q(r,s)&&r.d===s.d?r:(A(t,s),s)},w=(t,i)=>{const d=p(t);if(!i&&d&&(u.has(t)||Array.from(d.d).every(([l,a])=>{if(l===t)return!0;const h=w(l);return h===a||m(h,a)})))return d;const r=new Map;let s=!0;const o=l=>{if(L(t,l)){const h=p(l);if(h)return r.set(l,h),T(h);if(k(l))return r.set(l,void 0),l.init;throw new Error("no atom init")}const a=w(l);return r.set(l,a),T(a)};let n,c;const S={get signal(){return n||(n=new AbortController),n.signal},get setSelf(){return!c&&j(t)&&(c=(...l)=>{if(!s)return I(t,...l)}),c}};try{const l=t.read(o,S);return F(t,l,r,()=>n?.abort())}catch(l){return $(t,l,r)}finally{s=!1}},x=t=>T(w(t)),G=t=>{const i=n=>{var c,S;const l=new Set((c=u.get(n))==null?void 0:c.t);return(S=E.get(n))==null||S[1].forEach(a=>{l.add(a)}),l},d=new Array,r=new Set,s=n=>{if(!r.has(n)){r.add(n);for(const c of i(n))n!==c&&s(c);d.push(n)}};s(t);const o=new Set([t]);for(let n=d.length-1;n>=0;--n){const c=d[n],S=p(c);if(!S)continue;let l=!1;for(const a of S.d.keys())if(a!==c&&o.has(a)){l=!0;break}if(l){const a=w(c,!0);m(S,a)||o.add(c)}}},B=(t,...i)=>{const d=o=>T(w(o)),r=(o,...n)=>{const c=f.length>0;c||f.push(new Set([o]));let S;if(L(t,o)){if(!k(o))throw new Error("atom not writable");const l=p(o),a=F(o,n[0]);m(l,a)||G(o)}else S=B(o,...n);if(!c){const l=y(f.pop())}return S};return t.write(d,r,...i)},I=(t,...i)=>{f.push(new Set([t]));const d=B(t,...i),r=y(f.pop());return d},b=(t,i,d)=>{var r;const s=u.get(t);if(s)return i&&s.t.add(i),s;const o=d||[];(r=p(t))==null||r.d.forEach((c,S)=>{S!==t&&b(S,t,o)}),w(t);const n={t:new Set(i&&[i]),l:new Set};if(u.set(t,n),j(t)&&t.onMount){const{onMount:c}=t;o.push(()=>{const S=c((...l)=>I(t,...l));S&&(n.u=S)})}return d||o.forEach(c=>c()),n},H=(t,i)=>!i.l.size&&(!i.t.size||i.t.size===1&&i.t.has(t)),M=(t,i)=>{if(!H(t,i))return;const d=i.u;d&&d(),u.delete(t);const r=p(t);r&&(D(r)&&C(r.v),r.d.forEach((s,o)=>{if(o!==t){const n=u.get(o);n&&(n.t.delete(t),M(o,n))}}))},X=(t,i,d)=>{const r=new Set(i.d.keys()),s=new Set;d?.forEach((o,n)=>{if(r.has(n)){r.delete(n);return}s.add(n);const c=u.get(n);c&&c.t.delete(t)}),r.forEach(o=>{b(o,t)}),s.forEach(o=>{const n=u.get(o);n&&M(o,n)})},y=t=>{let i;const d=[],r=s=>{var o;if(!E.has(s))return;const[n,c]=E.get(s);E.delete(s),d.push([s,n]),c.forEach(r),(o=p(s))==null||o.d.forEach((S,l)=>r(l))};t.forEach(r),d.forEach(([s,o])=>{const n=p(s);if(n&&n!==o){const c=u.get(s);c&&n.d!==o?.d&&X(s,n,o?.d),c&&!(!D(o)&&(m(o,n)||q(o,n)))&&c.l.forEach(S=>S())}})};return{get:x,set:I,sub:(t,i)=>{const d=b(t),r=y([t]),s=d.l;return s.add(i),()=>{s.delete(i),M(t,d)}}}};let V;const oe=()=>(V||(V=ne()),V),se=oe,re=g.createContext(void 0),J=e=>{const u=g.useContext(re);return e?.store||u||se()},ie=e=>typeof e?.then=="function",ue=K.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(e.status="pending",e.then(u=>{e.status="fulfilled",e.value=u},u=>{e.status="rejected",e.reason=u}),e)});function ce(e,u){const f=J(u),[[E,P,U],p]=g.useReducer(v=>{const _=f.get(e);return Object.is(v[0],_)&&v[1]===f&&v[2]===e?v:[_,f,e]},void 0,()=>[f.get(e),f,e]);let R=E;(P!==f||U!==e)&&(p(),R=f.get(e));const A=u?.delay;return g.useEffect(()=>{const v=f.sub(e,()=>{if(typeof A=="number"){setTimeout(p,A);return}p()});return p(),v},[f,e,A]),g.useDebugValue(R),ie(R)?ue(R):R}function de(e,u){const f=J(u);return g.useCallback((...P)=>f.set(e,...P),[f,e])}function ae(e,u){return[ce(e,u),de(e,u)]}export{de as a,Se as b,ae as c,ce as u};

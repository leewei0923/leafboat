<!DOCTYPE html><html class=scrollbar-none lang=zh><head><meta charset=utf-8><link href=https://leewei0923.com/posts/read-the-super-tiny-compiler-code-2024-04-02.html rel=canonical><meta content="width=device-width,initial-scale=1" name=viewport><meta content="ie=edge" http-equiv=x-ua-compatible><link href=/favicon.ico rel=icon><link href=/apple-touch-icon.png rel=apple-touch-icon><title>read the super tiny compiler code</title><meta content="read the super tiny compiler code" name=title><meta name=description><link href=/rss.xml rel=alternate title="满和星 RSS Feed" type=application/rss+xml><link href=/sitemap-index.xml rel=sitemap title="满和星 site map" type=application/xml><meta content=https://leewei0923.com/posts/read-the-super-tiny-compiler-code-2024-04-02.html property=og:url><meta content="read the super tiny compiler code" property=og:title><meta content=website property=og:type><meta property=og:description><meta content=https://leewei0923.com/posts/read-the-super-tiny-compiler-code-2024-04-02.html.png property=og:image><meta content=满和星 property=og:site_name><meta content=summary_large_image name=twitter:card><meta content=https://leewei0923.com/posts/read-the-super-tiny-compiler-code-2024-04-02.html name=twitter:url><meta content="read the super tiny compiler code" name=twitter:title><meta name=twitter:description><meta content=https://leewei0923.com/posts/read-the-super-tiny-compiler-code-2024-04-02.html.png name=twitter:image><meta content=true name=astro-view-transitions-enabled><meta content=animate name=astro-view-transitions-fallback><link href=/_astro/about.CB-TPwyO.css rel=stylesheet><style>@keyframes astroFadeInOut{0%{opacity:1}to{opacity:0}}@keyframes astroFadeIn{0%{opacity:0}}@keyframes astroFadeOut{to{opacity:0}}@keyframes astroSlideFromRight{0%{transform:translate(100%)}}@keyframes astroSlideFromLeft{0%{transform:translate(-100%)}}@keyframes astroSlideToRight{to{transform:translate(100%)}}@keyframes astroSlideToLeft{to{transform:translate(-100%)}}@media (prefers-reduced-motion){::view-transition-group(*),::view-transition-new(*),::view-transition-old(*){animation:none!important}[data-astro-transition-scope]{animation:none!important}}</style><link href=/_astro/index.C04kFpGS.css rel=stylesheet><script type=module src=/_astro/hoisted.3Hjdn7Rh.js></script><script type=module src=/_astro/page.BG6Zv8O-.js></script></head><body class="flex flex-col bg-local bg-[#f7f7f7] dark:bg-[#202124] dark:text-neutral-50 justify-between lg:pb-[3dvh] lg:pt-[6dvh] min-h-dvh py-[2dvh] text-neutral-600"><div class="flex flex-col bg-local bg-neutral-50 dark:bg-[#212223] dark:shadow-[0_0_0.5em_0.25em_rgba(136,136,136,0.35)] grow lg:p-[2dvw] max-w-[1400px] mx-auto p-[3dvw] shadow-[0_0.5em_1em_0_rgba(236,236,236,0.86)] w-[90dvw]"><header class="justify-between grid grid-cols-2 items-start lg:flex"><a href=/ class="" aria-label="go to index" data-astro-transition-persist=astro-tpw7oqt3-1><svg class="fill-current ml-8 size-32" viewBox="0 0 314 114" data-icon=logo height=1em width=2.76em><title>go to index</title><symbol id=ai:local:logo><path d="M25.4 51.424c1.11-2.816 1.877-4.096 2.304-3.84.427.512-1.408 5.93-5.504 16.256a96.732 96.732 0 0 0-4.608 15.616c-.939 4.267-2.304 8.576-4.096 12.928-1.707 4.352-3.03 6.528-3.968 6.528-.768 0-2.645-1.92-5.632-5.76-2.39-2.987-2.859-4.95-1.408-5.888.427-.256 1.024-4.864 1.792-13.824.512-6.059.725-9.984.64-11.776 0-1.877-.299-3.584-.896-5.12-.939-2.133-1.408-3.456-1.408-3.968 0-.597.555-.896 1.664-.896 1.11 0 2.73 1.237 4.864 3.712l3.328 3.456-.512 6.784c-.427 4.437-.81 7.765-1.152 9.984-.427 2.219-.427 3.285 0 3.2.768-.17 4.48-6.87 11.136-20.096a221.796 221.796 0 0 0 3.456-7.296ZM11.064 15.456c.683-.597 2.133-.512 4.352.256 1.877.683 3.413 1.75 4.608 3.2 1.195 1.365 1.792 2.73 1.792 4.096 0 1.28-.427 2.432-1.28 3.456s-2.73 2.56-5.632 4.608c-2.39 1.707-3.584 2.816-3.584 3.328 0 .427-.427.64-1.28.64s-.427-1.835 1.28-5.504c1.28-2.816 1.92-4.992 1.92-6.528.085-1.621-.427-3.37-1.536-5.248-.853-1.11-1.067-1.877-.64-2.304Zm46.72-1.408c5.12 0 8.235 2.09 9.344 6.272.512 1.792 1.493 2.73 2.944 2.816 1.877.17 3.925.512 6.144 1.024 2.219.512 3.541.939 3.968 1.28.939.768 1.28 1.707 1.024 2.816-.17 1.024-.768 1.664-1.792 1.92l-7.68 1.792c-2.987.683-5.035 1.493-6.144 2.432-1.024.853-2.56 3.115-4.608 6.784l-2.688 4.608 2.176-.64c7.68-2.304 13.355-3.03 17.024-2.176 3.584.853 6.016 2.39 7.296 4.608 1.28 2.219 2.133 6.23 2.56 12.032.17 3.072.128 5.632-.128 7.68s-.853 4.907-1.792 8.576c-1.707 6.315-3.37 10.923-4.992 13.824-1.536 2.816-3.755 5.248-6.656 7.296-2.475 1.621-4.31 2.56-5.504 2.816-1.11.256-3.627.384-7.552.384-4.096 0-6.613-.085-7.552-.256-.853-.256-2.048-1.152-3.584-2.688-2.048-1.963-3.328-3.797-3.84-5.504-.256-1.11-.597-1.835-1.024-2.176-.341-.427-.981-.597-1.92-.512-8.704.768-13.056-.341-13.056-3.328 0-1.707.981-4.224 2.944-7.552 2.048-3.328 3.584-5.035 4.608-5.12 1.024 0 3.157-.043 6.4-.128 2.475-.17 4.01-.427 4.608-.768.597-.341 1.323-1.493 2.176-3.456 2.133-4.352 2.645-6.784 1.536-7.296-.085-.085-.213-.128-.384-.128-.597 0-1.963.683-4.096 2.048-1.536.853-2.517 1.323-2.944 1.408-.341 0-.81-.427-1.408-1.28-.853-1.11-1.28-2.39-1.28-3.84 0-1.45-.17-2.816-.512-4.096-.341-1.365.47-2.944 2.432-4.736l2.944-2.688-2.688.64c-1.11.17-1.963.17-2.56 0s-1.237-.768-1.92-1.792c-1.195-1.536-2.219-2.304-3.072-2.304-.768 0-1.963-.768-3.584-2.304-1.536-1.536-2.304-2.645-2.304-3.328 0-.768.427-1.323 1.28-1.664.939-.341 1.408-2.773 1.408-7.296 0-2.987.085-5.035.256-6.144.256-1.11.81-2.219 1.664-3.328.853-1.024 1.493-1.621 1.92-1.792.512-.17 1.195-.043 2.048.384 1.28.683 1.92 1.579 1.92 2.688 0 1.11.725 3.072 2.176 5.888 1.45 2.73 2.176 4.48 2.176 5.248 0 1.365 2.56.768 7.68-1.792.085-.085.17-.128.256-.128 1.621-.853 2.73-1.579 3.328-2.176.683-.683 1.11-1.579 1.28-2.688.597-2.901.725-4.992.384-6.272-.256-1.28-1.067-2.347-2.432-3.2-1.792-.939-2.688-1.621-2.688-2.048 0-.427 1.493-.64 4.48-.64Zm-11.136 32c-.256.939-.256 1.28 0 1.024.085-.085.213-.17.384-.256.683-.597 1.195-1.536 1.536-2.816.341-1.365.213-2.048-.384-2.048s-.896.427-.896 1.28-.213 1.792-.64 2.816Zm29.312 4.608c-.939-.597-2.005-.725-3.2-.384-1.195.341-3.797 1.493-7.808 3.456-2.048 1.024-3.456 1.835-4.224 2.432-.768.512-.981 1.067-.64 1.664 1.11 2.73 1.664 5.077 1.664 7.04 0 1.877-.597 4.31-1.792 7.296-.256.512-.213.981.128 1.408.427.341 1.195.81 2.304 1.408 1.707.683 3.03 1.579 3.968 2.688.939 1.024 1.365 2.005 1.28 2.944 0 .939-.555 1.664-1.664 2.176-.853.256-2.859-.043-6.016-.896-2.219-.597-3.712-.896-4.48-.896-.683 0-1.621.299-2.816.896-2.133 1.195-3.584 2.176-4.352 2.944-.683.768-.853 1.493-.512 2.176.768 1.28 2.517 3.03 5.248 5.248 2.73 2.219 4.565 3.328 5.504 3.328 2.56 0 5.461-1.365 8.704-4.096 3.243-2.73 5.59-5.803 7.04-9.216 1.536-3.328 2.688-7.765 3.456-13.312.768-5.547.853-9.77.256-12.672-.683-3.243-1.365-5.12-2.048-5.632ZM40.12 78.56c-1.28-.768-2.475-.768-3.584 0-1.11.683-1.664 1.835-1.664 3.456 0 2.219.939 2.645 2.816 1.28.512-.341 1.067-.853 1.664-1.536.768-.939 1.195-1.579 1.28-1.92.085-.427-.085-.853-.512-1.28Zm80.05-35.2c.256-.17.469-.256.64-.256.171-.085.469.128.896.64.427.427.939 1.067 1.536 1.92.597.768 1.365 1.877 2.304 3.328 1.621 2.304 2.603 3.968 2.944 4.992.341.939.384 2.176.128 3.712-.341 2.304-.341 3.456 0 3.456.427 0 1.664-2.09 3.712-6.272 1.451-3.243 2.347-4.864 2.688-4.864.085.085.043.683-.128 1.792-.341 2.133-1.237 4.608-2.688 7.424-1.451 2.73-2.645 7.339-3.584 13.824-.939 6.4-1.664 10.112-2.176 11.136-.512.939-.768 2.56-.768 4.864 0 2.219-.427 3.883-1.28 4.992-.597.853-1.024 1.28-1.28 1.28s-.811-.384-1.664-1.152c-1.109-1.024-2.432-2.944-3.968-5.76-1.109-2.048-1.707-3.37-1.792-3.968-.085-.683.171-1.621.768-2.816.853-1.621 1.28-3.499 1.28-5.632 0-2.133.469-6.656 1.408-13.568.939-6.997 1.237-11.819.896-14.464-.341-2.645-.299-4.181.128-4.608Zm68.864-29.184c1.195-.768 2.133-1.152 2.816-1.152.683 0 1.707.384 3.072 1.152 1.451.939 2.773 1.408 3.968 1.408 1.365 0 2.603.597 3.712 1.792s1.536 2.304 1.28 3.328c-.171.939-.896 1.621-2.176 2.048-1.195.341-3.883.725-8.064 1.152-7.765.768-14.08 2.987-18.944 6.656-3.499 2.56-6.741 5.717-9.728 9.472-2.901 3.67-3.925 5.93-3.072 6.784.256.17 1.92.341 4.992.512l4.736.128 2.432-5.504c1.536-3.755 2.859-6.016 3.968-6.784 1.109-.853 2.944-.81 5.504.128 2.048.768 3.755 1.792 5.12 3.072 1.365 1.28 1.835 2.39 1.408 3.328-.427 1.11-1.067 7.339-1.92 18.688-.853 11.264-1.408 19.883-1.664 25.856-.085 7.083-.469 11.179-1.152 12.288-1.109 2.048-3.029 2.901-5.76 2.56-2.731-.427-5.461-1.835-8.192-4.224-1.28-1.28-3.285-2.261-6.016-2.944l-4.096-.896 4.224-.64c7.168-.939 11.349-2.645 12.544-5.12.768-1.45 1.28-9.6 1.536-24.448l.64-22.272-6.016 11.776c-5.035 9.728-8.192 15.701-9.472 17.92-1.28 2.133-2.219 3.2-2.816 3.2-.683 0-1.664-1.237-2.944-3.712-1.195-2.56-1.792-4.437-1.792-5.632 0-1.536-.853-1.621-2.56-.256-.427.256-.896.64-1.408 1.152-4.011 4.437-6.656 2.688-7.936-5.248-.171-1.11-.171-1.963 0-2.56.256-.683.853-1.408 1.792-2.176 1.451-1.365 3.584-4.139 6.4-8.32a48.21 48.21 0 0 1 10.24-11.008c4.011-3.243 6.827-5.547 8.448-6.912l2.176-2.048-2.816.64c-1.792.256-5.675 1.579-11.648 3.968-4.779 1.877-8.192 2.987-10.24 3.328-2.048.341-3.797-.043-5.248-1.152-1.024-.768-2.048-1.152-3.072-1.152-1.024-.085-1.536-.555-1.536-1.408 0-1.536 2.176-2.304 6.528-2.304 2.133 0 9.301-2.048 21.504-6.144 12.288-4.181 19.371-6.955 21.248-8.32Zm-67.712-.128c0-1.28 1.28-1.323 3.84-.128.341.17.811.427 1.408.768 1.877.939 3.499 2.347 4.864 4.224 1.365 1.877 2.048 3.584 2.048 5.12 0 1.11-.853 2.347-2.56 3.712a19.987 19.987 0 0 1-5.76 3.2c-1.707.597-2.645.768-2.816.512-.085-.341.299-1.664 1.152-3.968 1.792-5.12 1.664-8.661-.384-10.624-1.195-1.11-1.792-2.048-1.792-2.816ZM252.7 57.184c1.621-4.779 2.816-5.504 3.584-2.176.853 3.67-.853 9.856-5.12 18.56-1.963 3.84-4.395 6.699-7.296 8.576-2.901 1.877-5.035 1.92-6.4.128-.427-.512-.427-1.152 0-1.92.427-.853 1.536-2.219 3.328-4.096 5.803-6.315 9.771-12.672 11.904-19.072Zm17.792-10.368c0-1.621 2.176-1.536 6.528.256a94.351 94.351 0 0 1 4.352 2.048l5.888 3.584 4.608-1.792c2.987-1.024 5.675-1.365 8.064-1.024 6.144.939 9.216 2.09 9.216 3.456 0 .768-.469 1.621-1.408 2.56-.939.939-1.92 1.408-2.944 1.408-.939 0-1.707.256-2.304.768-.512.427-3.243 1.152-8.192 2.176-4.949.939-7.637 1.621-8.064 2.048-.341.341-.981 2.09-1.92 5.248l-1.408 4.608h3.072c1.877 0 3.968.555 6.272 1.664 2.389 1.11 3.797 2.176 4.224 3.2.256.939-.853 3.456-3.328 7.552-2.475 4.01-4.693 6.784-6.656 8.32-.939.683-1.067 1.408-.384 2.176.768.683 3.541.725 8.32.128 4.864-.683 7.595-.768 8.192-.256.597.427 1.92.981 3.968 1.664 4.011 1.365 6.187 3.03 6.528 4.992.085 1.28-.811 2.176-2.688 2.688-1.365.256-5.205.256-11.52 0-7.168-.341-15.019.171-23.552 1.536s-13.739 2.944-15.616 4.736a24.165 24.165 0 0 1-3.968 2.816c-.853.341-1.493.469-1.92.384-.341 0-.768-.384-1.28-1.152-.939-1.28-1.749-3.84-2.432-7.68-.341-2.133-.085-3.499.768-4.096.853-.683 2.944-1.024 6.272-1.024 2.389 0 4.224-.17 5.504-.512 1.28-.341 2.688-.981 4.224-1.92 1.621-1.11 2.603-1.963 2.944-2.56.427-.683.64-1.664.64-2.944 0-1.963-.64-3.456-1.92-4.48-1.28-1.024-2.645-1.152-4.096-.384-1.451.768-2.688.896-3.712.384s-1.536-1.621-1.536-3.328c.085-3.499 1.493-5.376 4.224-5.632 1.28-.085 3.541-.427 6.784-1.024 2.389-.427 3.755-.853 4.096-1.28.427-.427.64-1.408.64-2.944 0-2.475-.299-4.01-.896-4.608-.597-.597-1.792-.47-3.584.384-2.816 1.11-5.205 1.323-7.168.64-1.963-.683-3.285-2.133-3.968-4.352-.683-2.304-.981-3.627-.896-3.968.171-.341 1.024-.341 2.56 0 1.707.341 4.352-.17 7.936-1.536 2.304-.939 3.712-1.664 4.224-2.176.597-.512.896-1.365.896-2.56 0-1.707-.597-3.285-1.792-4.736-1.195-1.536-1.792-2.688-1.792-3.456Zm3.968-41.472c4.437-2.219 7.595-3.584 9.472-4.096a20.13 20.13 0 0 1 5.888-.896c2.645 0 5.461.597 8.448 1.792 3.072 1.11 5.376 2.475 6.912 4.096.683.853.981 1.75.896 2.688 0 .939-.512 3.413-1.536 7.424-1.195 4.352-2.645 8.107-4.352 11.264-1.707 3.072-3.499 5.077-5.376 6.016-1.28.683-2.56 1.579-3.84 2.688-1.195 1.11-4.907 2.261-11.136 3.456-5.803.939-9.685 1.45-11.648 1.536-1.877.085-3.072-.341-3.584-1.28-.427-.939-1.579-1.45-3.456-1.536-1.621-.17-2.645-.47-3.072-.896-.427-.427-1.536-2.39-3.328-5.888a51.44 51.44 0 0 1-2.304-6.144c-.597-2.304-.981-4.096-1.152-5.376-.085-1.365.085-2.133.512-2.304.512 0 2.133 1.323 4.864 3.968 1.707 1.621 2.901 2.645 3.584 3.072.768.341 1.408.341 1.92 0 .768-.683 1.323-.853 1.664-.512.341.341 2.816-.299 7.424-1.92 3.072-.939 5.248-1.493 6.528-1.664 1.365-.17 2.859-.085 4.48.256 1.963.512 3.2.683 3.712.512.597-.17 1.237-.81 1.92-1.92a19.232 19.232 0 0 0 3.328-7.936c.597-2.901.341-4.565-.768-4.992-.853-.256-2.389.213-4.608 1.408-2.219 1.11-4.437 2.603-6.656 4.48-2.133 1.792-4.864 3.072-8.192 3.84-3.669.939-6.485 1.11-8.448.512-1.877-.597-3.456-2.048-4.736-4.352-.512-1.195-.683-1.877-.512-2.048.256-.17 1.28-.256 3.072-.256 2.475 0 7.168-1.664 14.08-4.992Zm8.32 25.472c-1.877-1.621-6.016-1.92-12.416-.896l-2.56.256 3.2 2.176c1.365.939 2.432 1.536 3.2 1.792.853.17 2.091.128 3.712-.128 4.011-.683 6.059-1.237 6.144-1.664 0-.256-.427-.768-1.28-1.536Z" fill=#525252 /></symbol><use xlink:href=#ai:local:logo></use></svg> </a><button aria-label="open menu" class="justify-self-end lg:hidden" title="open menu" data-astro-transition-persist=astro-r6ed7qza-2 id=menu-btn aria-controls=menu-items aria-expanded=false><svg class=size-8 viewBox="0 0 24 24" data-icon=ri:menu-fill height=1em width=1em><symbol id=ai:ri:menu-fill><path d="M3 4h18v2H3zm0 7h18v2H3zm0 7h18v2H3z" fill=currentColor /></symbol><use xlink:href=#ai:ri:menu-fill></use></svg></button><div class="hidden col-span-2 flex-col gap-3 lg:flex lg:items-end text-center" id=menu><div class="flex flex-col lg:flex-row gap-3 items-center lg:gap-8 lg:mb-7 mb-[2dvh]"><nav><ul class="flex flex-col lg:flex-row gap-3 font-default-sans"><li><button aria-label="Navigate to Home" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 dark:text-neutral-50 text-neutral-700" aria-pressed=false type=button data-nav=Home><a href=/ >Home</a></button></li><li><button aria-label="Navigate to Blog" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 dark:text-neutral-50 text-neutral-700" aria-pressed=true type=button data-nav=Blog><a href=/blog>Blog</a></button></li><li><button aria-label="Navigate to Tags" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 dark:text-neutral-50 text-neutral-700" aria-pressed=false type=button data-nav=Tags><a href=/tags>Tags</a></button></li><li><button aria-label="Navigate to Archives" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 dark:text-neutral-50 text-neutral-700" aria-pressed=false type=button data-nav=Archives><a href=/archives>Archives</a></button></li><li><button aria-label="Navigate to About" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 dark:text-neutral-50 text-neutral-700" aria-pressed=false type=button data-nav=About><a href=/about>About</a></button></li></ul></nav><a href=/search aria-label="Navigate to search page" title="Navigate to search page"><svg class="hover:opacity-100 opacity-75" viewBox="0 0 24 24" data-icon=ri:search-2-line height=1em width=1em><symbol id=ai:ri:search-2-line><path d="M11 2c4.968 0 9 4.032 9 9s-4.032 9-9 9s-9-4.032-9-9s4.032-9 9-9m0 16c3.867 0 7-3.133 7-7s-3.133-7-7-7s-7 3.133-7 7s3.133 7 7 7m8.485.071l2.829 2.828l-1.415 1.415l-2.828-2.829z" fill=currentColor /></symbol><use xlink:href=#ai:ri:search-2-line></use></svg></a><div class="flex gap-3 forced-colors:hidden" data-astro-transition-persist=astro-t5bszqxv-6><button aria-label="Switch to os-default theme" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 theme-toggler" aria-pressed=false type=button data-theme=os-default><svg class=fill-current viewBox="0 0 24 24" data-icon=ri:contrast-fill height=1em width=1em><symbol id=ai:ri:contrast-fill><path d="M12 21.997c-5.523 0-10-4.477-10-10s4.477-10 10-10s10 4.477 10 10s-4.477 10-10 10m0-2v-16a8 8 0 0 0 0 16" fill=currentColor /></symbol><use xlink:href=#ai:ri:contrast-fill></use></svg></button><button aria-label="Switch to light theme" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 theme-toggler" aria-pressed=false type=button data-theme=light><svg class=fill-current viewBox="0 0 24 24" data-icon=ri:sun-fill height=1em width=1em><symbol id=ai:ri:sun-fill><path d="M12 18a6 6 0 1 1 0-12a6 6 0 0 1 0 12M11 1h2v3h-2zm0 19h2v3h-2zM3.515 4.929l1.414-1.414L7.05 5.636L5.636 7.05zM16.95 18.364l1.414-1.414l2.121 2.121l-1.414 1.414zm2.121-14.85l1.414 1.415l-2.121 2.121l-1.414-1.414zM5.636 16.95l1.414 1.414l-2.121 2.121l-1.414-1.414zM23 11v2h-3v-2zM4 11v2H1v-2z" fill=currentColor /></symbol><use xlink:href=#ai:ri:sun-fill></use></svg></button><button aria-label="Switch to dark theme" class="hover:opacity-100 opacity-75 aria-pressed:opacity-100 theme-toggler" aria-pressed=false type=button data-theme=dark><svg class=fill-current viewBox="0 0 24 24" data-icon=ri:moon-line height=1em width=1em><symbol id=ai:ri:moon-line><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12S6.477 2 12 2h.1A6.98 6.98 0 0 0 10 7m-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938A7.999 7.999 0 0 0 4 12" fill=currentColor /></symbol><use xlink:href=#ai:ri:moon-line></use></svg></button></div></div><div>微微风簇浪，散作满河星。</div><div class="flex gap-3 flex-wrap justify-center lg:mt-0 mt-[2dvh]"><a href=mailto:leewei2547@gmail.me aria-label=mail><svg class="hover:opacity-100 opacity-75 fill-current" viewBox="0 0 24 24" data-icon=ri:mail-fill height=1em width=1em><title>mail</title><symbol id=ai:ri:mail-fill><path d="M3 3h18a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1m9.06 8.683L5.648 6.238L4.353 7.762l7.72 6.555l7.581-6.56l-1.308-1.513z" fill=currentColor /></symbol><use xlink:href=#ai:ri:mail-fill></use></svg> </a><a href=https://github.com/leewei0923 aria-label=github><svg class="hover:opacity-100 opacity-75 fill-current" viewBox="0 0 24 24" data-icon=ri:github-fill height=1em width=1em><title>github</title><symbol id=ai:ri:github-fill><path d="M12.001 2c-5.525 0-10 4.475-10 10a9.994 9.994 0 0 0 6.837 9.488c.5.087.688-.213.688-.476c0-.237-.013-1.024-.013-1.862c-2.512.463-3.162-.612-3.362-1.175c-.113-.288-.6-1.175-1.025-1.413c-.35-.187-.85-.65-.013-.662c.788-.013 1.35.725 1.538 1.025c.9 1.512 2.337 1.087 2.912.825c.088-.65.35-1.087.638-1.337c-2.225-.25-4.55-1.113-4.55-4.938c0-1.088.387-1.987 1.025-2.687c-.1-.25-.45-1.275.1-2.65c0 0 .837-.263 2.75 1.024a9.28 9.28 0 0 1 2.5-.337c.85 0 1.7.112 2.5.337c1.913-1.3 2.75-1.024 2.75-1.024c.55 1.375.2 2.4.1 2.65c.637.7 1.025 1.587 1.025 2.687c0 3.838-2.337 4.688-4.562 4.938c.362.312.675.912.675 1.85c0 1.337-.013 2.412-.013 2.75c0 .262.188.574.688.474A10.016 10.016 0 0 0 22 12c0-5.525-4.475-10-10-10" fill=currentColor /></symbol><use xlink:href=#ai:ri:github-fill></use></svg> </a><a href=/rss.xml aria-label="the RSS link"><svg class="hover:opacity-100 opacity-75 fill-current" viewBox="0 0 24 24" data-icon=ri:rss-fill height=1em width=1em><title>the RSS link</title><symbol id=ai:ri:rss-fill><path d="M3 3c9.941 0 18 8.059 18 18h-3c0-8.284-6.716-15-15-15zm0 7c6.075 0 11 4.925 11 11h-3a8 8 0 0 0-8-8zm0 7a4 4 0 0 1 4 4H3z" fill=currentColor /></symbol><use xlink:href=#ai:ri:rss-fill></use></svg></a></div></div></header><main class="pt-[2dvh] lg:pt-[6dvh] px-[2dvw]"><h1 class="font-extrabold text-5xl">read the super tiny compiler code</h1><div class="dark:text-neutral-300 lg:my-[3dvh] my-[1dvh] text-neutral-600"><div class="flex flex-col lg:flex-row *:flex *:items-center lg:gap-4 opacity-70"><time datetime=2024-05-03T15:03:15.852Z><svg class=fill-current viewBox="0 0 24 24" data-icon=ri:time-line height=1em width=1em aria-label=date><title>date</title><symbol id=ai:ri:time-line><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10s-4.477 10-10 10m0-2a8 8 0 1 0 0-16a8 8 0 0 0 0 16m1-8h4v2h-6V7h2z" fill=currentColor /></symbol><use xlink:href=#ai:ri:time-line></use></svg> 2024/5/3 23:03:15 </time><time datetime=2024-05-15T15:48:09.757Z><svg class=fill-current viewBox="0 0 24 24" data-icon=ri:history-line height=1em width=1em aria-label="last modified date"><title>last modified date</title><symbol id=ai:ri:history-line><path d="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12h2a8 8 0 1 0 1.385-4.5H8v2H2v-6h2V6a9.985 9.985 0 0 1 8-4m1 5v4.585l3.243 3.243l-1.415 1.415L11 12.413V7z" fill=currentColor /></symbol><use xlink:href=#ai:ri:history-line></use></svg> 2024/5/15 23:48:09 </time><span><svg class=fill-current viewBox="0 0 24 24" data-icon=ri:hourglass-fill height=1em width=1em aria-label="read time"><title>read time</title><symbol id=ai:ri:hourglass-fill><path d="M6 4H4V2h16v2h-2v2c0 1.615-.816 2.915-1.844 3.977c-.703.726-1.558 1.395-2.425 2.023c.867.628 1.722 1.297 2.425 2.023C17.184 15.085 18 16.385 18 18v2h2v2H4v-2h2v-2c0-1.615.816-2.915 1.844-3.977c.703-.726 1.558-1.395 2.425-2.023c-.867-.628-1.722-1.297-2.425-2.023C6.816 8.915 6 7.615 6 6zm2 0v2c0 .685.26 1.335.771 2h6.458c.51-.665.771-1.315.771-2V4zm4 9.222c-1.045.738-1.992 1.441-2.719 2.192a6.84 6.84 0 0 0-.51.586h6.458a6.851 6.851 0 0 0-.51-.586c-.727-.751-1.674-1.454-2.719-2.192" fill=currentColor /></symbol><use xlink:href=#ai:ri:hourglass-fill></use></svg> 14 min read</span></div><div><a href=/tags/code/1 class="hover:opacity-100 mr-2 opacity-80 text-xl" aria-label="More posts of tag code">code </a><a href=/tags/techique/1 class="hover:opacity-100 mr-2 opacity-80 text-xl" aria-label="More posts of tag techique">techique</a></div></div><article class="[&#38;_.toc-item]:my-0 [&#38;_.toc-level]:mt-0 [&#38;_iframe]:rounded-lg [&#38;_p_code]:after:content-none [&#38;_p_code]:before:content-none [&#38;_p_code]:bg-neutral-100 [&#38;_p_code]:p-1 [&#38;_p_code]:rounded dark:[&#38;_p_code]:bg-[#121212] dark:prose-invert max-w-full prose prose-img:rounded-lg prose-p:hyphens-auto prose-p:text-justify prose-pre:!bg-neutral-100 prose-pre:rounded-lg prose-video:rounded-lg"><nav class=toc><ol class="toc-level toc-level-1"><li class="toc-item toc-item-h2"><a href=#tokenizer class="toc-link toc-link-h2">tokenizer</a></li><li class="toc-item toc-item-h2"><a href=#parser class="toc-link toc-link-h2">parser</a></li><li class="toc-item toc-item-h2"><a href=#traverser class="toc-link toc-link-h2">traverser</a></li><li class="toc-item toc-item-h2"><a href=#transformer class="toc-link toc-link-h2">transformer</a></li><li class="toc-item toc-item-h2"><a href=#codegenerator class="toc-link toc-link-h2">codeGenerator</a></li><li class="toc-item toc-item-h2"><a href=#compiler class="toc-link toc-link-h2">compiler</a></li></ol></nav><p>今天看到这个star个数超多的，尝试读一读这个源码，也试试去了解。</p><p>开始读源码前，要先看下这个注释的。带有这个注释，这个代码量是不止200行的。注释写的很详细。</p><p>它的一个主要功能是用来将<code>Lisp</code>风格的代码，转换成<code>C</code>风格的代码。</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>// 该程序包含这几个方法函数</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>tokenizer</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#a0ada0;--shiki-dark:#758575DD> // 词法解析函数</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    </span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>parser</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#a0ada0;--shiki-dark:#758575DD> // 解析器</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    </span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>traverser</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    </span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>transformer</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    </span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>codeGenerator</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    </span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>compiler</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line></span></code></pre></div><h2 id=tokenizer>tokenizer</h2><p>该函数是一个词法分析器，用于将输入的字符串分解成一系列的（tokens）,方便后续的处理。</p><p>将输入的字符串按照以下四个规则分解成以下几种类型。</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> tokenizer</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>input</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> current</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#2f798a;--shiki-dark:#4C9A91> 0</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> [];</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  while</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666> &#x3C;</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#998418;--shiki-dark:#B8A965>length</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> char</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>     </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 1.括号：开括号“（”和闭括号“）”</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      tokens</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      });</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      continue</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>)</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      tokens</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>)</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      });</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      continue</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>     2</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>忽略空白字符串</span><span style=color:#393a34;--shiki-dark:#DBD7CAEE> </span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> WHITESPACE</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> /</span><span style=color:#a65e2b;--shiki-dark:#C99076>\s</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>/</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>WHITESPACE</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>test</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#999;--shiki-dark:#666666>))</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      continue</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#2f798a;--shiki-dark:#4C9A91>    3.</span><span style=color:#b07d48;--shiki-dark:#BD976A> 这里用来获取连续的数字字符</span><span style=color:#393a34;--shiki-dark:#DBD7CAEE>，</span><span style=color:#b07d48;--shiki-dark:#BD976A>连续的数字字符构成数字token</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> NUMBERS</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> /</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#a65e2b;--shiki-dark:#C99076>0-9</span><span style=color:#999;--shiki-dark:#666666>]</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>/</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>NUMBERS</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>test</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#999;--shiki-dark:#666666>))</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>      let</span><span style=color:#b07d48;--shiki-dark:#BD976A> value</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> ''</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      while</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>NUMBERS</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>test</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#999;--shiki-dark:#666666>))</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        value</span><span style=color:#ab5959;--shiki-dark:#CB7676> +=</span><span style=color:#b07d48;--shiki-dark:#BD976A> char</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        char</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      }</span></span>
<span class=line></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      tokens</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span><span style=color:#998418;--shiki-dark:#B8A965> type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>number</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> value</span><span style=color:#999;--shiki-dark:#666666> });</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      continue</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    4</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>获取被双引号包裹的文本内容</span><span style=color:#393a34;--shiki-dark:#DBD7CAEE>，</span><span style=color:#b07d48;--shiki-dark:#BD976A>被标记为string类型值为字符串内容</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>"</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>      let</span><span style=color:#b07d48;--shiki-dark:#BD976A> value</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> ''</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      char</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      while</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>"</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        value</span><span style=color:#ab5959;--shiki-dark:#CB7676> +=</span><span style=color:#b07d48;--shiki-dark:#BD976A> char</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        char</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      }</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      char</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      tokens</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span><span style=color:#998418;--shiki-dark:#B8A965> type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>string</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> value</span><span style=color:#999;--shiki-dark:#666666> });</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      continue</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    5</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>用来获取连续的字符</span><span style=color:#393a34;--shiki-dark:#DBD7CAEE>，</span><span style=color:#b07d48;--shiki-dark:#BD976A>然后标记为函数名</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> LETTERS</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> /</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#a65e2b;--shiki-dark:#C99076>a-z</span><span style=color:#999;--shiki-dark:#666666>]</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>/</span><span style=color:#1e754f;--shiki-dark:#4D9375>i</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>LETTERS</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>test</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#999;--shiki-dark:#666666>))</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>      let</span><span style=color:#b07d48;--shiki-dark:#BD976A> value</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> ''</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      while</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>LETTERS</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>test</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>char</span><span style=color:#999;--shiki-dark:#666666>))</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        value</span><span style=color:#ab5959;--shiki-dark:#CB7676> +=</span><span style=color:#b07d48;--shiki-dark:#BD976A> char</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        char</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> input</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      }</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      tokens</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span><span style=color:#998418;--shiki-dark:#B8A965> type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>name</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> value</span><span style=color:#999;--shiki-dark:#666666> });</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      continue</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    throw</span><span style=color:#ab5959;--shiki-dark:#CB7676> new</span><span style=color:#59873a;--shiki-dark:#80A665> TypeError</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#b56959;--shiki-dark:#C98A7D>I dont know what this character is: </span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span><span style=color:#b07d48;--shiki-dark:#BD976A> char</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  return</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>}</span></span>
<span class=line></span></code></pre></div><h2 id=parser>parser</h2><p>这里parser的功能就是用来转换成抽象语法树（AST）</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>let</span><span style=color:#b07d48;--shiki-dark:#BD976A> ast</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    body</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  };</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>// 这是初始值</span></span>
<span class=line></span></code></pre></div><p>在该<code>parser</code>中，最重要的是<code>walk</code>这个函数，它的作用是遍历<code>tokenizer</code>生成的<code>tokens</code>。</p><p>定义了</p><ul><li>NumberLiteral</li><li>StringLiteral</li><li>CallExpression</li></ul><p>这三种类型</p><p>使用递归来处理嵌套的调用表达式</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>if</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    )</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>      let</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        name</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        params</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      };</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      while</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#ab5959;--shiki-dark:#CB7676> ||</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>)</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      )</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>params</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#59873a;--shiki-dark:#80A665>walk</span><span style=color:#999;--shiki-dark:#666666>());</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      }</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span></code></pre></div><p>以上代码我不太理解这段</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#1e754f;--shiki-dark:#4D9375> while</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#ab5959;--shiki-dark:#CB7676> ||</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>)</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      )</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>params</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#59873a;--shiki-dark:#80A665>walk</span><span style=color:#999;--shiki-dark:#666666>());</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      }</span></span>
<span class=line></span></code></pre></div><p>这部分是一个逻辑表达式，用于判断是否继续循环解析函数参数。让我们分解一下：</p><ol><li><code>(token.type !== 'paren')</code>: 这部分检查当前 token 的类型是否不是 ‘paren’。如果不是 ‘paren’，则意味着我们尚未到达函数参数列表的结束括号 ’)‘，因此需要继续解析参数。这样做是为了处理可能的函数嵌套以及其他可能的语法结构。</li><li><code>||</code>：这是逻辑或运算符，意味着只要两者中有一个条件为真，整个表达式就为真。</li><li><code>(token.type === 'paren' &#x26;&#x26; token.value !== ')')</code>: 这部分检查当前 token 的类型是否是 ‘paren’ 且其值不等于 ’)‘。这意味着当前 token 是一个左括号 ’(‘，而不是右括号 ’)‘，因此函数参数列表尚未结束，需要继续解析参数。</li></ol><p>来源：chatgpt</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> parser</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>tokens</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> current</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#2f798a;--shiki-dark:#4C9A91> 0</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  function</span><span style=color:#59873a;--shiki-dark:#80A665> walk</span><span style=color:#999;--shiki-dark:#666666>()</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>number</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>NumberLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      };</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>string</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>StringLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      };</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    )</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>      let</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        name</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>        params</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      };</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      while</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#ab5959;--shiki-dark:#CB7676> ||</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        (</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> ===</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>paren</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>)</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      )</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>params</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#59873a;--shiki-dark:#80A665>walk</span><span style=color:#999;--shiki-dark:#666666>());</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        token</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      }</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      current</span><span style=color:#ab5959;--shiki-dark:#CB7676>++</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    throw</span><span style=color:#ab5959;--shiki-dark:#CB7676> new</span><span style=color:#59873a;--shiki-dark:#80A665> TypeError</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>token</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> ast</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    body</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  };</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  while</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>current</span><span style=color:#999;--shiki-dark:#666666> &#x3C;</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#998418;--shiki-dark:#B8A965>length</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>    ast</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>body</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#59873a;--shiki-dark:#80A665>walk</span><span style=color:#999;--shiki-dark:#666666>());</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  return</span><span style=color:#b07d48;--shiki-dark:#BD976A> ast</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>}</span></span>
<span class=line></span></code></pre></div><h2 id=traverser>traverser</h2><p><code>traverser</code>用来访问AST</p><p>内部定义了<code>traverseArray</code>和<code>traverseNode</code>两个函数。</p><ol><li><code>traverseArray</code> 函数用于遍历一个节点数组，并对数组中的每个节点调用 <code>traverseNode</code> 函数。</li></ol><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  function</span><span style=color:#59873a;--shiki-dark:#80A665> traverseArray</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>array</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>    array</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>forEach</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>child</span><span style=color:#999;--shiki-dark:#666666> =></span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      traverseNode</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>child</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    });</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line></span></code></pre></div><ol start=2><li><code>traverseNode</code> 函数是实际的遍历函数。它接受两个参数：<code>node</code>（当前要遍历的节点）和 <code>parent</code>（该节点的父节点）</li></ol><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>  // traverseNode 函数是实际的遍历函数。它接受两个参数：node（当前要遍历的节点）和 parent（该节点的父节点）。</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> traverseNode</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 首先，它检查 visitor 对象中是否存在当前节点类型 node.type 对应的方法集合 methods。</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> methods</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> visitor</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 如果存在 methods，并且其中包含 enter 方法，那么调用 enter 方法，并传入当前节点 node 和其父节点 parent。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>methods</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>enter</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>  </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 使用 switch 语句根据当前节点的类型进行不同的处理：</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    switch</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型是 'Program'，则遍历其 body 属性中的子节点数组。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>        traverseArray</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>body</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        break</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型是 'CallExpression'，则遍历其 params 属性中的子节点数组。          </span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>        traverseArray</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>params</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        break</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型是 'NumberLiteral' 或 'StringLiteral'，则不执行任何操作。            </span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>NumberLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>   </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型不在上述列举的类型中，则抛出 TypeError，表示不支持的节点类型。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>StringLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        break</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      default</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        throw</span><span style=color:#ab5959;--shiki-dark:#CB7676> new</span><span style=color:#59873a;--shiki-dark:#80A665> TypeError</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 如果存在 methods，并且其中包含 exit 方法，那么在处理完当前节点后，调用 exit 方法，并传入当前节点 node 和其父节点 parent。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>methods</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>exit</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 最后，调用 traverseNode 函数，传入 AST 的根节点 ast 和 null，表示根节点没有父节点。</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>exit</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line></span></code></pre></div><p><strong>traverser总览</strong></p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> traverser</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> visitor</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span><span style=color:#393a34;--shiki-dark:#DBD7CAEE> </span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  function</span><span style=color:#59873a;--shiki-dark:#80A665> traverseArray</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>array</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>    array</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>forEach</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>child</span><span style=color:#999;--shiki-dark:#666666> =></span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      traverseNode</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>child</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    });</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  function</span><span style=color:#59873a;--shiki-dark:#80A665> traverseNode</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>    let</span><span style=color:#b07d48;--shiki-dark:#BD976A> methods</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> visitor</span><span style=color:#999;--shiki-dark:#666666>[</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>];</span></span>
<span class=line></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>methods</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>enter</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    switch</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>        traverseArray</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>body</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        break</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>            </span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>        traverseArray</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>params</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        break</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>            </span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>NumberLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>            </span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>StringLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        break</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      default</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        throw</span><span style=color:#ab5959;--shiki-dark:#CB7676> new</span><span style=color:#59873a;--shiki-dark:#80A665> TypeError</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>methods</span><span style=color:#ab5959;--shiki-dark:#CB7676> &#x26;&#x26;</span><span style=color:#b07d48;--shiki-dark:#BD976A> methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>exit</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>      methods</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>exit</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>  traverseNode</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#ab5959;--shiki-dark:#CB7676> null</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>}</span></span>
<span class=line></span>
<span class=line></span></code></pre></div><h2 id=transformer>transformer</h2><p>这段代码是一个 AST 转换器 <code>transformer</code> 函数，它接受一个 AST（抽象语法树）作为输入，并返回一个经过转换后的新 AST。</p><ol><li>在 <code>transformer</code> 函数内部，首先创建了一个新的 AST 对象 <code>newAst</code>，它具有类型 <code>'Program'</code>，并且没有任何节点，即 <code>body</code> 属性是一个空数组。</li></ol><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>let</span><span style=color:#b07d48;--shiki-dark:#BD976A> newAst</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    body</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  };</span></span>
<span class=line></span></code></pre></div><ol start=2><li>接着，将原始的 AST 的 <code>_context</code> 属性设置为新 AST 的 <code>body</code> 属性。这样做是为了在遍历原始 AST 的过程中，能够方便地向新 AST 中添加节点。</li></ol><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> newAst</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>body</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line></span></code></pre></div><ol start=3><li>调用 <code>traverser</code> 函数遍历原始 AST，同时传入了一个对象作为第二个参数，这个对象包含了对不同类型节点的处理方法。</li></ol><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#59873a;--shiki-dark:#80A665>traverser</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 对于 'NumberLiteral' 和 'StringLiteral' 类型的节点，分别定义了处理方法。这些处理方法会在遍历到相应节点时被调用，将相应类型的节点转换成新的节点并添加到新的 AST 中。</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    NumberLiteral</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>NumberLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        });</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      },</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    },</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 对于 'CallExpression' 类型的节点，定义了另外一个处理方法。在进入 'CallExpression' 节点时，会创建一个新的表达式对象 expression，并设置它的类型为 'CallExpression'，设置 callee 属性为一个标识符对象，表示函数名，然后初始化 arguments 属性为一个空数组，用于存储函数参数。</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    StringLiteral</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>StringLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        });</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      },</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    },</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 如果当前节点的父节点不是 'CallExpression'，那么将新创建的 expression 对象包装成一个 'ExpressionStatement' 节点。这是因为在语法树中，函数调用可能出现在语句的上下文中，所以需要进行适当的调整。</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    CallExpression</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>        let</span><span style=color:#b07d48;--shiki-dark:#BD976A> expression</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          callee</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Identifier</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            name</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>name</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>          },</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          arguments</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        };</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> expression</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>arguments</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>          expression</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>ExpressionStatement</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            expression</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> expression</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>          };</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        }</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>      // 最后，在处理完当前节点后，将新创建的表达式对象添加到父节点的 _context 中。</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>expression</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      },</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  });</span></span>
<span class=line></span></code></pre></div><p><strong>代码总览</strong></p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> transformer</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> newAst</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    body</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  };</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>  ast</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> newAst</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>body</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>  traverser</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    NumberLiteral</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>NumberLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        });</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      },</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    },</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    StringLiteral</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>({</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>StringLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          value</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        });</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      },</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    },</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>    CallExpression</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>      enter</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>,</span><span style=color:#b07d48;--shiki-dark:#BD976A> parent</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>        let</span><span style=color:#b07d48;--shiki-dark:#BD976A> expression</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          callee</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Identifier</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            name</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>name</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>          },</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>          arguments</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#999;--shiki-dark:#666666> [],</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        };</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#b07d48;--shiki-dark:#BD976A> expression</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>arguments</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>        if</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#ab5959;--shiki-dark:#CB7676> !==</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>          expression</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            type</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>ExpressionStatement</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#998418;--shiki-dark:#B8A965>            expression</span><span style=color:#999;--shiki-dark:#666666>:</span><span style=color:#b07d48;--shiki-dark:#BD976A> expression</span><span style=color:#999;--shiki-dark:#666666>,</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>          };</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        }</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        parent</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>_context</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>push</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>expression</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      },</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>    }</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  });</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  return</span><span style=color:#b07d48;--shiki-dark:#BD976A> newAst</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>}</span></span>
<span class=line></span>
<span class=line></span></code></pre></div><h2 id=codegenerator>codeGenerator</h2><p>这段代码是一个用于生成代码的函数 <code>codeGenerator</code>，它接受一个 AST 节点作为输入，并返回相应的代码字符串。</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> codeGenerator</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  switch</span><span style=color:#999;--shiki-dark:#666666> (</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 如果节点类型是 'Program'，则遍历 body 数组中的每个子节点，并对每个子节点递归调用 codeGenerator 函数，然后使用 join('\n') 将所有生成的代码字符串连接起来，并以换行符分隔。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Program</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>body</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>map</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>codeGenerator</span><span style=color:#999;--shiki-dark:#666666>)</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>        .</span><span style=color:#59873a;--shiki-dark:#80A665>join</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#a65e2b;--shiki-dark:#C99076>\n</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>          </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>	// 如果节点类型是 'ExpressionStatement'，则递归调用 codeGenerator 函数生成表达式的代码字符串，并在最后加上一个分号。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>ExpressionStatement</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>        codeGenerator</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>expression</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span></span>
<span class=line><span style=color:#b5695999;--shiki-dark:#C98A7D99>        '</span><span style=color:#b56959;--shiki-dark:#C98A7D>;</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#a0ada0;--shiki-dark:#758575DD> // &#x3C;&#x3C; (...because we like to code the *correct* way)</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      );</span></span>
<span class=line></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>    // 如果节点类型是 'CallExpression'，则生成调用表达式的代码字符串。首先生成调用函数的代码字符串，然后在括号内生成参数的代码字符串，参数之间用逗号分隔。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>CallExpression</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#999;--shiki-dark:#666666> (</span></span>
<span class=line><span style=color:#59873a;--shiki-dark:#80A665>        codeGenerator</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>callee</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span></span>
<span class=line><span style=color:#b5695999;--shiki-dark:#C98A7D99>        '</span><span style=color:#b56959;--shiki-dark:#C98A7D>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span></span>
<span class=line><span style=color:#b07d48;--shiki-dark:#BD976A>        node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>arguments</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#59873a;--shiki-dark:#80A665>map</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>codeGenerator</span><span style=color:#999;--shiki-dark:#666666>)</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>          .</span><span style=color:#59873a;--shiki-dark:#80A665>join</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#b56959;--shiki-dark:#C98A7D>, </span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span></span>
<span class=line><span style=color:#b5695999;--shiki-dark:#C98A7D99>        '</span><span style=color:#b56959;--shiki-dark:#C98A7D>)</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>      );</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>	// 如果节点类型是 'Identifier'，则直接返回标识符的名称。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>Identifier</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>name</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型是 'NumberLiteral'，则直接返回数值字面量的值。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>NumberLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>   </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型是 'StringLiteral'，则返回带有双引号的字符串字面量。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    case</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>StringLiteral</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      return</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>"</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span><span style=color:#b07d48;--shiki-dark:#BD976A> node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>value</span><span style=color:#ab5959;--shiki-dark:#CB7676> +</span><span style=color:#b5695999;--shiki-dark:#C98A7D99> '</span><span style=color:#b56959;--shiki-dark:#C98A7D>"</span><span style=color:#b5695999;--shiki-dark:#C98A7D99>'</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>   // 如果节点类型不是以上任何一种，则抛出 TypeError。</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>    default</span><span style=color:#999;--shiki-dark:#666666>:</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>      throw</span><span style=color:#ab5959;--shiki-dark:#CB7676> new</span><span style=color:#59873a;--shiki-dark:#80A665> TypeError</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>node</span><span style=color:#999;--shiki-dark:#666666>.</span><span style=color:#b07d48;--shiki-dark:#BD976A>type</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>  }</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>}</span></span>
<span class=line></span></code></pre></div><h2 id=compiler>compiler</h2><p>下面代码的作用是将输入的字符串经过词法分析、语法分析、转换和代码生成等步骤之后，返回一个编译后的代码字符串。</p><div class="relative group"><span class="absolute right-2 -top-3 group-hover:hidden text-sm">js</span><button aria-label="Copy code" class="hidden absolute bg-[#121212] copy dark:bg-neutral-100 group group-hover:block px-1 right-2 rounded-md top-2" aria-pressed=false title="Copy code"><svg class="dark:fill-[#121212] fill-neutral-100 size-6 group-aria-pressed:hidden" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M6.9998 6V3C6.9998 2.44772 7.44752 2 7.9998 2H19.9998C20.5521 2 20.9998 2.44772 20.9998 3V17C20.9998 17.5523 20.5521 18 19.9998 18H16.9998V20.9991C16.9998 21.5519 16.5499 22 15.993 22H4.00666C3.45059 22 3 21.5554 3 20.9991L3.0026 7.00087C3.0027 6.44811 3.45264 6 4.00942 6H6.9998ZM5.00242 8L5.00019 20H14.9998V8H5.00242ZM8.9998 6H16.9998V16H18.9998V4H8.9998V6ZM7 11H13V13H7V11ZM7 15H13V17H7V15Z"></path></svg><svg class="hidden dark:fill-[#121212] fill-neutral-100 group-aria-pressed:block size-6" viewBox="0 0 24 24" xmlns=http://www.w3.org/2000/svg><path d="M9.9997 15.1709L19.1921 5.97852L20.6063 7.39273L9.9997 17.9993L3.63574 11.6354L5.04996 10.2212L9.9997 15.1709Z"></path></svg></button><pre class="astro-code astro-code-themes vitesse-dark vitesse-light" data-language=js lang=js style=background-color:#fff;--shiki-dark-bg:#121212;color:#393a34;--shiki-dark:#dbd7caee;overflow-x:auto tabindex=0><code><span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>function</span><span style=color:#59873a;--shiki-dark:#80A665> compiler</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>input</span><span style=color:#999;--shiki-dark:#666666>)</span><span style=color:#999;--shiki-dark:#666666> {</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>  // tokenizer(input): 调用 tokenizer 函数对输入的字符串进行词法分析，将其分解成一个个的标记（tokens）。</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> tokens</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#59873a;--shiki-dark:#80A665> tokenizer</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>input</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>    </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>  // parser(tokens): 将词法分析得到的标记数组作为输入，调用 parser 函数对这些标记进行语法分析，构建出对应的抽象语法树（AST）。</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> ast</span><span style=color:#999;--shiki-dark:#666666>    =</span><span style=color:#59873a;--shiki-dark:#80A665> parser</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>tokens</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE>   </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD> // transformer(ast): 将语法分析得到的抽象语法树作为输入，调用 transformer 函数进行转换，生成一个新的经过处理的 AST。</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> newAst</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#59873a;--shiki-dark:#80A665> transformer</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>ast</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#393a34;--shiki-dark:#DBD7CAEE> </span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD> // codeGenerator(newAst): 将经过转换后的新 AST 作为输入，调用 codeGenerator 函数生成对应的代码字符串。</span></span>
<span class=line><span style=color:#ab5959;--shiki-dark:#CB7676>  let</span><span style=color:#b07d48;--shiki-dark:#BD976A> output</span><span style=color:#999;--shiki-dark:#666666> =</span><span style=color:#59873a;--shiki-dark:#80A665> codeGenerator</span><span style=color:#999;--shiki-dark:#666666>(</span><span style=color:#b07d48;--shiki-dark:#BD976A>newAst</span><span style=color:#999;--shiki-dark:#666666>);</span></span>
<span class=line><span style=color:#a0ada0;--shiki-dark:#758575DD>  // and simply return the output!</span></span>
<span class=line><span style=color:#1e754f;--shiki-dark:#4D9375>  return</span><span style=color:#b07d48;--shiki-dark:#BD976A> output</span><span style=color:#999;--shiki-dark:#666666>;</span></span>
<span class=line><span style=color:#999;--shiki-dark:#666666>}</span></span>
<span class=line></span></code></pre></div></article><hr class="mx-auto bg-zinc-200 border-0 dark:bg-zinc-700 h-1 md:my-10 my-4 rounded w-48"><div class="[&_main]:transition-colors giscus"></div></main></div><footer class="text-center lg:mt-[4dvh] mt-[3dvh]" data-astro-transition-persist=astro-tvayyljk-4><p class="lg:mb-[2dvh] mb-[1dvh]">肆意闪耀</p><p class="opacity-75 text-neutral-700 dark:text-neutral-300">&copy; 2024 Ladit. Powered by <a href=https://astro.build class=underline aria-label="Read more about Astro" rel=noopener target=_blank>Astro</a>. <a href=https://github.com/ladit/astro-blog-zozo class=underline aria-label="Read more about this theme" rel=noopener target=_blank>Theme</a> by Ladit.</p></footer><button aria-label="Back to top" class="hidden fixed 	bottom-6 	right-6 size-10 	cursor-pointer 	place-content-center 	rounded-full 	bg-[#f0f0f0] 	opacity-60 	hover:opacity-100 	dark:bg-[#555555]" title="Back to top" data-astro-transition-persist=astro-w6n6ksoh-5 id=back-to-top><svg class="fill-current self-center size-8" viewBox="0 0 24 24" data-icon=ri:arrow-up-double-fill height=1em width=1em><symbol id=ai:ri:arrow-up-double-fill><path d="m12 4.836l-6.207 6.207l1.414 1.414L12 7.664l4.793 4.793l1.414-1.414zm0 5.65l-6.207 6.207l1.414 1.414L12 13.314l4.793 4.793l1.414-1.414z" fill=currentColor /></symbol><use xlink:href=#ai:ri:arrow-up-double-fill></use></svg></button></body></html><script type=module>const copy=async t=>{const e=t.nextElementSibling?.children[0];e&&(await navigator.clipboard.writeText(e.textContent),t.setAttribute("aria-pressed","true"),setTimeout((()=>{t.setAttribute("aria-pressed","false")}),700))},copyButtons=Array.from(document.querySelectorAll(".prose button.copy"));for(const t of copyButtons)t.addEventListener("click",(()=>copy(t)))</script>